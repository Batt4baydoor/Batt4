<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remote Garage Controller</title>
    <!-- Load Tailwind CSS for easy, clean styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <!-- Main Container -->
    <div class="w-full max-w-md bg-white rounded-xl shadow-2xl p-6 md:p-8">
        <h1 class="text-3xl font-extrabold text-gray-800 mb-6 text-center">Batt 4 Bay Door</h1>

        <!-- Button Grid: Changed to a single column (grid-cols-1) -->
        <div class="grid grid-cols-1 gap-4">
            
            <button id="open-btn" data-action="open" class="btn open-btn bg-green-500 hover:bg-green-600 text-white py-4 rounded-lg font-bold shadow-md transition duration-150 ease-in-out transform hover:scale-[1.02]">
                OPEN
            </button>
            
            <button id="close-btn" data-action="close" class="btn close-btn bg-red-500 hover:bg-red-600 text-white py-4 rounded-lg font-bold shadow-md transition duration-150 ease-in-out transform hover:scale-[1.02]">
                CLOSE
            </button>
            
            <button id="stop-btn" data-action="stop" class="btn stop-btn bg-yellow-500 hover:bg-yellow-600 text-gray-800 py-4 rounded-lg font-bold shadow-md transition duration-150 ease-in-out transform hover:scale-[1.02]">
                STOP
            </button>

            <button id="close30-btn" data-action="close30" class="btn timed-btn bg-blue-500 hover:bg-blue-600 text-white py-4 rounded-lg font-bold shadow-md transition duration-150 ease-in-out transform hover:scale-[1.02]">
                CLOSE FOR 30s
            </button>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-sm">
            <h2 id="modal-title" class="text-xl font-bold mb-4 text-gray-800"></h2>
            <p id="modal-message" class="text-gray-600 mb-6"></p>
            <button id="modal-ok-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded-lg font-semibold transition duration-150">
                OK
            </button>
        </div>
    </div>

    <script>
        // --- IMPORTANT: BASE_WEBHOOK_URL is now configured with the URL provided by the user.
        const BASE_WEBHOOK_URL = 'https://io.adafruit.com/api/v2/webhooks/feed/hHhGwUpJbyLogeqKbWVnFz37Y1Py'; 

        // The full URLs are now constructed by appending the ?value=command query parameter directly 
        // to the base Webhook Receiver URL (removing the invalid /raw path).
        const WEBHOOK_URLS = {
            'open': BASE_WEBHOOK_URL + '?value=open',
            'close': BASE_WEBHOOK_URL + '?value=close',
            'stop': BASE_WEBHOOK_URL + '?value=stop',
            'close30': BASE_WEBHOOK_URL + '?value=close30',
        };

        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalOkBtn = document.getElementById('modal-ok-btn');

        /**
         * @brief Displays the custom confirmation modal.
         * @param {string} title - The title of the modal.
         * @param {string} message - The message body.
         * @param {string} type - 'success' or 'error' for coloring.
         */
        function showModal(title, message) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            // Use 'flex' to make the modal visible and centered
            modal.style.display = 'flex'; 
        }

        modalOkBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });


        /**
         * @brief Sends the HTTP request to the Adafruit IO Webhook.
         * @param {string} action - The command to execute (e.g., 'open').
         */
        async function sendCommand(action) {
            const url = WEBHOOK_URLS[action];
            
            // Should not happen now that the BASE_WEBHOOK_URL is set, but kept for robustness.
            if (!url || url.includes('YOUR_')) {
                showModal('Error', `Webhook URL for ${action.toUpperCase()} is incomplete. Contact support.`);
                return;
            }

            try {
                // We use GET because the command is passed in the query parameter '?value=command'
                const response = await fetch(url, { method: 'GET' }); 

                if (response.ok) {
                    const message = action === 'close30' 
                        ? 'Command sent successfully. Door closing sequence initiated for 30 seconds.' 
                        : `Command sent successfully. Door action: ${action.toUpperCase()}.`;
                    
                    showModal('Success!', message);
                } else {
                    // Check if the body contains meaningful error text
                    let errorText = await response.text();
                    errorText = errorText.substring(0, 100) || 'No details provided.'; 
                    showModal('API Error', `Failed to send command. Server responded with status ${response.status}. Error: ${errorText}. Double-check your Adafruit IO Webhook setup.`);
                }
            } catch (error) {
                showModal('Connection Error', `Could not reach the webhook server. Check your internet connection. Error: ${error.message}`);
            }
        }

        // Attach event listeners to all buttons with the class 'btn'
        document.querySelectorAll('.btn').forEach(button => {
            button.addEventListener('click', (event) => {
                const action = event.currentTarget.getAttribute('data-action');
                sendCommand(action);
            });
        });

    </script>
</body>
</html>
